{% extends "base.html" %}
{% block start %}
<!-- ðŸ”„ Loading Spinner -->
<div id="loader" class="fixed inset-0 flex items-center justify-center bg-white z-[9999] hidden">
  <div class="flex flex-col items-center space-y-3">
    <div class="w-14 h-14 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></div>
    <p class="text-gray-600 font-medium">Loading...</p>
  </div>
</div>
<div id="spinnerOverlay" 
       class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center gap-10 justify-center z-50">
    <div class="w-16 h-16 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></div>
    <p class="text-white font-medium">Sending The Data...</p>
</div>
<div>
  <style>
    body {
      font-family: "Inter", sans-serif;
      background-color: #f9fafb;
    }

    .modal-backdrop {
      transition: opacity 0.3s ease;
    }

    .modal-content {
      transition: transform 0.3s ease;
    }
  </style>

  <!-- Header (your existing code kept) -->
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
      <div class="container mx-auto px-6 py-4">
      <nav class="flex items-center justify-between">
        <!-- Logo -->
        <a href="/" class="flex items-center space-x-2">
          <svg
            class="h-8 w-8 text-red-500"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"
            />
          </svg>
          <h1 class="text-2xl font-bold text-gray-800">Rakthdaan</h1>
        </a>

        <!-- Desktop Navigation Links -->
        <div class="hidden md:flex items-center space-x-2">
          <a
            href="/"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >Home</a
          >
          <a
            href="/blood_bank"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >Blood Banks</a
          >
          <a
            href="/about"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >About</a
          >
          <a
            href="/contact_us"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >Contact Us</a
          >
        </div>

        <!-- CTA Buttons (Dynamic) -->
        <div class="hidden md:flex items-center space-x-4">
          {% if user.is_authenticated %} {% if user.is_staff %}
          <a
            href="/admin-dashboard"
            class="bg-blue-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-600 shadow-md"
            >Admin Dashboard</a
          >
          <a
            href="/logout"
            class="text-gray-600 font-semibold px-4 py-2 hover:text-red-500"
            >Logout</a
          >
          {% else %}
          <a
            href="/profile"
            class="bg-white text-red-500 font-semibold px-5 py-2 rounded-lg hover:bg-gray-100 shadow-sm border"
            >My Profile</a
          >
          <a
            href="/logout"
            class="text-gray-600 font-semibold px-4 py-2 hover:text-red-500"
            >Logout</a
          >
          {% endif %} {% else %}
          <a
            href="/login"
            class="bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 shadow-md"
            >Login</a
          >
          {% endif %}
        </div>

        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button id="menu-btn" class="focus:outline-none">
            <svg
              id="menu-open-icon"
              class="w-6 h-6 text-gray-800"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
              />
            </svg>
            <svg
              id="menu-close-icon"
              class="w-6 h-6 text-gray-800 hidden"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
      </nav>
    </div>
    <!-- Mobile Menu Panel -->
    <div
      id="mobile-menu"
      class="hidden md:hidden absolute top-full left-0 w-full bg-white z-40 shadow-md"
    >
      <div class="px-6 py-4 space-y-2">
        <a
          href="/blood_request"
          class="block text-red-500 font-semibold bg-red-100 py-2 px-3 rounded-lg"
          >Request Blood</a
        >
        <a
          href="/blood_banks"
          class="block text-gray-600 font-semibold py-2 px-3 rounded-lg hover:bg-gray-100"
          >Blood Banks</a
        >
        <a
          href="/about"
          class="block text-gray-600 font-semibold py-2 px-3 rounded-lg hover:bg-gray-100"
          >About</a
        >
        <div class="border-t border-gray-200 pt-4 mt-2 space-y-2">
          {% if user.is_authenticated %} {% if user.is_staff %}
          <a
            href="/admin-dashboard"
            class="block w-full text-center bg-blue-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-600"
            >Admin Dashboard</a
          >
          {% else %}
          <a
            href="/donor-profile"
            class="block w-full text-center bg-gray-100 text-gray-800 font-semibold px-5 py-2 rounded-lg"
            >My Profile</a
          >
          {% endif %}
          <a
            href="/logout"
            class="block w-full text-center bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600"
            >Logout</a
          >
          {% else %}
          <a
            href="/login"
            class="block w-full text-center bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600"
            >Login</a
          >
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-12">
    <div
      class="bg-white rounded-2xl shadow-xl overflow-hidden lg:grid lg:grid-cols-2"
    >
      <!-- Left Side: Informational Panel -->
    <div class="p-8 md:p-12 bg-gradient-to-br from-red-500 to-red-600 text-white">
           <h2 class="text-3xl font-bold mb-4">Your Lifeline in an Emergency</h2>
        <p class="text-red-100 mb-6">
          Fill out the form to securely notify verified donors. We prioritize
          your privacy and safety above all.
        </p>
        <div class="space-y-6">
          <div class="flex items-start">
            <svg
              class="w-7 h-7 mr-4 text-red-200 flex-shrink-0"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <div>
              <h3 class="font-semibold text-lg">Step 1: Submit Your Request</h3>
              <p class="text-red-100 text-sm">
                Provide patient details and your contact number. Your
                information is encrypted and secure.
              </p>
            </div>
          </div>
          <div class="flex items-start">
            <svg
              class="w-7 h-7 mr-4 text-red-200 flex-shrink-0"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"
              />
            </svg>
            <div>
              <h3 class="font-semibold text-lg">Step 2: Donors are Notified</h3>
              <p class="text-red-100 text-sm">
                Our system instantly and privately alerts matching donors near
                the hospital's location.
              </p>
            </div>
          </div>
          <div class="flex items-start">
            <svg
              class="w-7 h-7 mr-4 text-red-200 flex-shrink-0"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"
              />
            </svg>
            <div>
              <h3 class="font-semibold text-lg">Step 3: Get Connected</h3>
              <p class="text-red-100 text-sm">
                Once a donor accepts, you will immediately receive their contact
                details via SMS to coordinate.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side: Form -->
      <div class="p-8 md:p-12">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-800 text-center">
          Urgent Blood Request
        </h2>
        <p class="mt-2 text-md text-gray-500 text-center">
          Fill in the details below to find a match.
        </p>
        <form id="requestForm" class="mt-8 space-y-6" action="#" method="POST">
          {% csrf_token %}

          {% if error %}
          <div class="mb-4 p-3 bg-red-100 text-red-700 rounded-md">
            {{ error }}
          </div>
          {% endif %}

          <div>
            <label
              for="patient-name"
              class="block text-sm font-semibold text-gray-700"
              >Patient's Full Name</label
            >
            <input
              type="text"
              id="patient-name"
              name="patient_name"
              placeholder="Enter patient's name"
              class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition"
            />
          </div>

          <div class="grid sm:grid-cols-2 gap-6">
            <div>
              <label
                for="blood-group"
                class="block text-sm font-semibold text-gray-700"
                >Required Blood Group</label
              >
              <select
                id="blood-group"
                name="blood_group"
                class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition"
              >
                <option value="">Select Blood Group</option>
                <option>A+</option>
                <option>A-</option>
                <option>B+</option>
                <option>B-</option>
                <option>AB+</option>
                <option>AB-</option>
                <option>O+</option>
                <option>O-</option>
              </select>
            </div>
            <!-- CONTACT NUMBER INPUT - UPDATED -->
            <div>
                <label for="contact-number" class="block text-sm font-semibold text-gray-700">Your Contact Number</label>
                <div class="flex mt-1">
                    <span class="inline-flex items-center px-3 border border-r-0 border-gray-300 bg-gray-50 text-gray-500 rounded-l-md">
                      +91
                    </span>
                    <input type="tel" name="contact_number" id="contact-number" placeholder="98765 43210" 
                           class="block w-full px-4 py-3 bg-white border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" 
                           maxlength="10">
                </div>
            </div>
            <div>
              <label
                for="email-id"
                class="block text-sm font-semibold text-gray-700"
                >Your Email Id</label
              >
              <input
                type="email"
                id="email-id"
                name="email_id"
                placeholder="example@gmail.com"
                class="mt-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition"
              />
            </div>
          <div>
         <label for="hospital" class="block text-sm font-semibold text-gray-700">Select Hospital</label>
  <select id="hospital" name="hospital_name" class="mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" required>
    <option value="">Select</option>
    <option {% if hospital == "Goa Medical College Blood Bank" %}selected{% endif %}>Goa Medical College Blood Bank</option>
    <option {% if hospital == "Manipal Hospital Blood Bank" %}selected{% endif %}>Manipal Hospital Blood Bank</option>
    <option {% if hospital == "Hospicio Hospital Blood Bank" %}selected{% endif %}>Hospicio Hospital Blood Bank</option>
    <option {% if hospital == "Asilo Hospital Blood Bank" %}selected{% endif %}>Asilo Hospital Blood Bank</option>
    <option {% if hospital == "District Hospital Blood Bank" %}selected{% endif %}>District Hospital Blood Bank</option>
    <option {% if hospital == "Red Cross Blood Bank" %}selected{% endif %}>Red Cross Blood Bank</option>
    <option {% if hospital == "Sub District Hospital Blood Bank" %}selected{% endif %}>Sub District Hospital Blood Bank</option>
    <option {% if hospital == "Vrundavan Hospital Blood Bank" %}selected{% endif %}>Vrundavan Hospital Blood Bank</option>
    <option {% if hospital == "Apollo Victor Hospital Blood Bank" %}selected{% endif %}>Apollo Victor Hospital Blood Bank</option>
    <option {% if hospital == "Shri Sai Central Blood Bank & Lab" %}selected{% endif %}>Shri Sai Central Blood Bank & Lab</option>
    <option {% if hospital == "Fonsecas Pathology Laboratory / Blood Bank" %}selected{% endif %}>Fonsecas Pathology Laboratory / Blood Bank</option>
    <option {% if hospital == "Jeevandhara Blood Bank" %}selected{% endif %}>Jeevandhara Blood Bank</option>
  </select>   
          </div>
          </div>
          <div class="pt-4">
            <button
              type="button"
              id="urgentRequestBtn"
              class="w-full bg-red-500 text-white font-bold py-4 px-6 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2"
            >
              <svg
                class="w-5 h-5"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 005.135 9.25h6.115a.75.75 0 010 1.5H5.135a1.5 1.5 0 00-1.442 1.086L2.279 16.76a.75.75 0 00.95.826l16-5.333a.75.75 0 000-1.418l-16-5.333z"
                />
              </svg>
              <span>Send Urgent Request</span>
            </button>
          </div>
          </div>

        </form>
      </div>
    </div>
  </main>

  <!-- Success Modal -->
  {% if message %}
  <div
    id="successModal"
    class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 p-4 modal-backdrop"
  >
    <div
      class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center modal-content scale-95"
    >
      <div
        class="mx-auto bg-green-100 rounded-full h-16 w-16 inline-flex items-center justify-center mb-5"
      >
        <svg
          class="w-8 h-8 text-green-500"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
      </div>
      <h3 class="text-2xl font-bold text-gray-800">Request Sent!</h3>
      <p class="text-gray-600 mt-3">
        Verified donors in Goa have been notified. You will receive an SMS with
        a donor's contact details as soon as one accepts the request.
      </p>
      <button
        id="closeModalBtn"
        class="mt-6 w-full bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition"
      >
        Close
      </button>
    </div>
  </div>
  {% endif %}

  <!-- Footer -->
  <footer class="bg-gray-800 text-white mt-12">
    <div class="container mx-auto py-10 px-6">
      <div class="grid md:grid-cols-3 gap-8">
        <div>
          <h3 class="font-bold text-xl mb-2">Rakthdaan</h3>
          <p class="text-gray-400">
            Connecting blood donors with recipients to save lives.
          </p>
        </div>
        <div>
          <h3 class="font-bold text-xl mb-2">Quick Links</h3>
          <ul class="text-gray-400 space-y-2">
            <li><a href="/" class="hover:text-white">Home</a></li>
            <li><a href="/about" class="hover:text-white">About Us</a></li>
            <li><a href="/contact_us" class="hover:text-white">Contact Us</a></li>

          </ul>
        </div>
        <div>
          <h3 class="font-bold text-xl mb-2">Contact</h3>
          <ul class="text-gray-400 space-y-2">
            <li><a href="#" class="hover:text-white">contact@rakthadaan.org</a></li>
            <li><a href="#" class="hover:text-white">+91-1234567890</a></li>
          </ul>
        </div>
      </div>
      <div class="mt-8 border-t border-gray-700 pt-6 text-center text-gray-500">
        &copy; 2024 Rakthdaan. All Rights Reserved.
      </div>
    </div>
  </footer>

  <script>
    // Mobile Menu Toggle
    const menuBtn = document.getElementById("menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const openIcon = document.getElementById("menu-open-icon");
    const closeIcon = document.getElementById("menu-close-icon");

    menuBtn?.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
      openIcon.classList.toggle("hidden");
      closeIcon.classList.toggle("hidden");
    });

    // Modal Logic
    const successModal = document.getElementById("successModal");
    const closeModalBtn = document.getElementById("closeModalBtn");

    closeModalBtn?.addEventListener("click", () => {
      successModal.classList.add("hidden");
    
    });

    successModal?.addEventListener("click", (e) => {
      if (e.target === successModal) {
        successModal.classList.add("hidden");
      }
    });

    document.addEventListener("DOMContentLoaded", function() {
    const loader = document.getElementById("loader");

    function showLoaderAndNavigate(target) {
      loader.classList.remove("hidden");
      loader.style.opacity = "1";

      sessionStorage.setItem("navigating", "true");

      setTimeout(() => {
        window.location = target.getAttribute("href");
      }, 1000); 
    }

    const internalLinks = document.querySelectorAll(
  'a[href="/blood_bank"], ' +
  'a[href="/about"], ' +
  'a[href="/contact_us"], ' +
  'a[href="/login"], ' +
  'a[href="/logout"], ' +
  'a[href="/admin-dashboard"], ' +
  'a[href="/profile"], ' +
  'a[href="/form"],'+
  'a[href="/blood_request"]'
);


      internalLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          showLoaderAndNavigate(this);
        });
      });
  });

  window.addEventListener("load", function() {
    const loader = document.getElementById("loader");
    if (loader) {
      loader.style.opacity = "0";
      loader.style.transition = "opacity 0.5s ease";
      setTimeout(() => loader.classList.add("hidden"), 500);
    }
    sessionStorage.removeItem("navigating");
  });

  window.addEventListener("pageshow", function(event) {
    const loader = document.getElementById("loader");
    if (event.persisted || sessionStorage.getItem("navigating") !== "true") {
      if (loader) loader.classList.add("hidden");
    }
  });
const urgentBtn = document.getElementById('urgentRequestBtn');
const spinnerOverlay = document.getElementById('spinnerOverlay');
const form = document.getElementById('requestForm');

urgentBtn.addEventListener('click', () => {
  spinnerOverlay.classList.remove('hidden'); 

  setTimeout(() => {
    form.submit(); 
  }, 500); 
});
  </script>
</div>
{% endblock %}
