{% extends "base.html" %} {% block start %}
<!-- ðŸ”„ Loading Spinner -->
<div
  id="loader"
  class="fixed inset-0 flex items-center justify-center bg-white z-[9999] hidden"
>
  <div class="flex flex-col items-center space-y-3">
    <div
      class="w-14 h-14 border-4 border-red-500 border-t-transparent rounded-full animate-spin"
    ></div>
    <p class="text-gray-600 font-medium">Loading...</p>
  </div>
</div>
<div>
  <style>
    body {
      font-family: "Inter", sans-serif;
      background-color: #f9fafb;
    }
    /* Styling for the toggle switch */
    .toggle-checkbox:checked {
      right: 0;
      border-color: #4ade80; /* green-400 */
    }
    .toggle-checkbox:checked + .toggle-label {
      background-color: #4ade80; /* green-400 */
    }
  </style>

  <!-- Header -->
  <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
    <div class="container mx-auto px-6 py-4">
      <nav class="flex items-center justify-between">
        <!-- Logo -->
        <a href="/" class="flex items-center space-x-2">
          <svg
            class="h-8 w-8 text-red-500"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"
            />
          </svg>
          <h1 class="text-2xl font-bold text-gray-800">Rakthdaan</h1>
        </a>

        <!-- Desktop Navigation Links -->
        <div class="hidden md:flex items-center space-x-2">
          <a
            href="/"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >Home</a
          >
          <a
            href="/blood_bank"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >Blood Banks</a
          >
          <a
            href="/about"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >About</a
          >
          <a
            href="/contact_us"
            class="text-gray-600 font-semibold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors"
            >Contact Us</a
          >
        </div>

        <!-- CTA Buttons (Dynamic) -->
        <div class="hidden md:flex items-center space-x-4">
          {% if user.is_authenticated %} {% if user.is_staff %}
          <a
            href="/admin-dashboard"
            class="bg-blue-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-600 shadow-md"
            >Admin Dashboard</a
          >
          {% else %}
          <a
            href="/profile"
            class="bg-red-500 text-white font-semibold px-5 py-2 rounded-lg shadow-sm"
            >My Profile</a
          >
          {% endif %}
          <a
            href="/logout"
            class="text-gray-600 font-semibold px-4 py-2 hover:text-red-500"
            >Logout</a
          >
          {% else %}
          <a
            href="/login"
            class="bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 shadow-md"
            >Login</a
          >
          {% endif %}
        </div>

        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button id="menu-btn" class="focus:outline-none">
            <svg
              id="menu-open-icon"
              class="w-6 h-6 text-gray-800"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
              />
            </svg>
            <svg
              id="menu-close-icon"
              class="w-6 h-6 text-gray-800 hidden"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
      </nav>
    </div>
    <!-- Mobile Menu Panel -->
    <div
      id="mobile-menu"
      class="hidden md:hidden absolute top-full left-0 w-full bg-white z-40 shadow-md"
    >
      <div class="px-6 py-4 space-y-2">
        <a
          href="/"
          class="block text-gray-600 font-semibold py-2 px-3 rounded-lg hover:bg-gray-100"
          >Home</a
        >
        <a
          href="/blood_bank"
          class="block text-gray-600 font-semibold py-2 px-3 rounded-lg hover:bg-gray-100"
          >Blood Banks</a
        >
        <a
          href="/about"
          class="block text-gray-600 font-semibold py-2 px-3 rounded-lg hover:bg-gray-100"
          >About</a
        >
        <a
          href="/contact_us"
          class="block text-gray-600 font-semibold py-2 px-3 rounded-lg hover:bg-gray-100"
          >Contact Us</a
        >
        <div class="border-t border-gray-200 pt-4 mt-2 space-y-2">
          {% if user.is_authenticated %} {% if user.is_staff %}
          <a
            href="/admin-dashboard"
            class="block w-full text-center bg-blue-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-600"
            >Admin Dashboard</a
          >
          {% else %}
          <a
            href="/profile"
            class="block w-full text-center bg-red-500 text-white font-semibold px-5 py-2 rounded-lg"
            >My Profile</a
          >
          {% endif %}
          <a
            href="/logout"
            class="block w-full text-center bg-gray-200 text-gray-800 font-semibold px-5 py-2 rounded-lg hover:bg-gray-300"
            >Logout</a
          >
          {% else %}
          <a
            href="/login"
            class="block w-full text-center bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600"
            >Login</a
          >
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-12">
    <div class="text-center mb-12">
      <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800">
        My Donor Profile
      </h1>
      <p class="mt-3 text-lg text-gray-500">
        Keep your information up-to-date to help us connect you with those in
        need.
      </p>
    </div>

    <div
      class="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden"
    >
      <form method="POST">
        {% csrf_token %}
        <div class="p-8 space-y-6">
          <!-- Profile Header -->
          <div class="flex flex-col sm:flex-row items-center sm:space-x-6">
            <div
              class="w-24 h-24 bg-red-100 rounded-full flex items-center justify-center text-red-500 text-4xl font-bold"
            >
              {{ user.donor.name|first|upper }}
            </div>
            <div class="text-center sm:text-left mt-4 sm:mt-0">
              <h2 class="text-2xl font-bold text-gray-800">{{ donor.name }}</h2>
              <p class="text-gray-500">
                Blood Group:
                <span class="font-semibold text-red-500"
                  >{{ user.donor.blood_group }}</span
                >
              </p>
            </div>
          </div>

          <div class="border-t border-gray-200"></div>

          <!-- Availability Status -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">
              My Availability
            </h3>
            <div
              class="flex items-center justify-between bg-gray-50 p-4 rounded-lg"
            >
              <p class="text-gray-600">
                Set my status to "Available" for donation requests.
              </p>
              <label class="relative inline-flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  name="is_active"
                  class="sr-only peer"
                  {%
                  if
                  user.donor.is_active
                  %}checked{%
                  endif
                  %}
                />
                <div
                  class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-red-200 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"
                ></div>
              </label>
            </div>
          </div>

          <div class="border-t border-gray-200"></div>

          <!-- Personal Information Form -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label
                for="full-name"
                class="block text-sm font-semibold text-gray-700"
                >Full Name</label
              >
              <input
                type="text"
                name="name"
                id="full-name"
                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"
                value="{{ user.donor.name }}"
              />
            </div>
            <div>
              <label
                for="email"
                class="block text-sm font-semibold text-gray-700"
                >Email Address</label
              >
              <input
                type="email"
                name="email"
                id="email"
                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"
                value="{{ user.email }}"
              />
            </div>

            <!-- PHONE NUMBER INPUT - UPDATED -->
            <div>
              <label
                for="phone_number"
                class="block text-sm font-semibold text-gray-700"
                >Phone Number</label
              >
              <div class="flex mt-1">
                <span
                  class="inline-flex items-center px-3 border border-r-0 border-gray-300 bg-gray-50 text-gray-500 rounded-l-md"
                >
                  +91
                </span>
                <input
                  type="tel"
                  name="phone_number"
                  id="phone_number"
                  class="block w-full px-4 py-3 bg-white border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"
                  value="{{ user.donor.phone_number.national_number }}"
                  maxlength="10"
                />
              </div>
            </div>

            <div>
              <label
                for="address"
                class="block text-sm font-semibold text-gray-700"
                >Address / City</label
              >
              <input
                type="text"
                name="address"
                id="address"
                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"
                value="{{ user.donor.address }}"
              />
            </div>
            <div>
              <label
                for="last_donation_date"
                class="block text-sm font-semibold text-gray-700"
                >Last Donation Date</label
              >
              <input
                type="date"
                name="last_donation_date"
                id="last_donation_date"
                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"
                value="{{ user.donor.last_donation_date|date:'Y-m-d' }}"
              />
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="bg-gray-50 px-8 py-4 text-right">
          <button
            type="submit"
            class="bg-red-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 shadow-lg"
          >
            Update Profile
          </button>
        </div>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white mt-12">
    <div class="container mx-auto py-10 px-6">
      <div class="grid md:grid-cols-3 gap-8">
        <div>
          <h3 class="font-bold text-xl mb-2">Rakthdaan</h3>
          <p class="text-gray-400">
            Connecting blood donors with recipients to save lives.
          </p>
        </div>
        <div>
          <h3 class="font-bold text-xl mb-2">Quick Links</h3>
          <ul class="text-gray-400 space-y-2">
            <li><a href="/" class="hover:text-white">Home</a></li>
            <li><a href="/about" class="hover:text-white">About Us</a></li>
            <li><a href="/contact" class="hover:text-white">Contact Us</a></li>
          </ul>
        </div>
        <div>
          <h3 class="font-bold text-xl mb-2">Contact</h3>
          <ul class="text-gray-400 space-y-2">
            <li>
              <a href="mailto:contact@rakthadaan.org" class="hover:text-white"
                >contact@rakthadaan.org</a
              >
            </li>
            <li>
              <a href="tel:+911234567890" class="hover:text-white"
                >+911234567890</a
              >
            </li>
          </ul>
        </div>
      </div>
      <div class="mt-8 border-t border-gray-700 pt-6 text-center text-gray-500">
        &copy; 2024 Rakthdaan. All Rights Reserved.
      </div>
    </div>
  </footer>

  <script>
    // --- Mobile Menu Logic ---
    const menuBtn = document.getElementById("menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const openIcon = document.getElementById("menu-open-icon");
    const closeIcon = document.getElementById("menu-close-icon");

    menuBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
      openIcon.classList.toggle("hidden");
      closeIcon.classList.toggle("hidden");
    });

    document.addEventListener("DOMContentLoaded", function () {
      const loader = document.getElementById("loader");

      function showLoaderAndNavigate(target) {
        loader.classList.remove("hidden");
        loader.style.opacity = "1";

        sessionStorage.setItem("navigating", "true");

        setTimeout(() => {
          window.location = target.getAttribute("href");
        }, 1000);
      }

       const internalLinks = document.querySelectorAll(
  'a[href="/blood_bank"], ' +
  'a[href="/about"], ' +
  'a[href="/contact_us"], ' +
  'a[href="/login"], ' +
  'a[href="/logout"], ' +
  'a[href="/admin-dashboard"], ' +
  'a[href="/profile"], ' +
  'a[href="/form"],'+
  'a[href="/blood_request"]'
);


      internalLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          showLoaderAndNavigate(this);
        });
      });
    });

    window.addEventListener("load", function () {
      const loader = document.getElementById("loader");
      if (loader) {
        loader.style.opacity = "0";
        loader.style.transition = "opacity 0.5s ease";
        setTimeout(() => loader.classList.add("hidden"), 500);
      }
      sessionStorage.removeItem("navigating");
    });

    window.addEventListener("pageshow", function (event) {
      const loader = document.getElementById("loader");
      if (event.persisted || sessionStorage.getItem("navigating") !== "true") {
        if (loader) loader.classList.add("hidden");
      }
    });
    const urgentBtn = document.getElementById("urgentRequestBtn");
    const spinnerOverlay = document.getElementById("spinnerOverlay");
    const form = document.getElementById("requestForm");

    urgentBtn.addEventListener("click", () => {
      spinnerOverlay.classList.remove("hidden");

      setTimeout(() => {
        form.submit();
      }, 500);
    });
  </script>
</div>
{% endblock %}
