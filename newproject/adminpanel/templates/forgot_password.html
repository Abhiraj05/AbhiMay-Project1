{% extends "base.html" %}
{% block start %}
<div id="loader" class="fixed inset-0 flex items-center justify-center bg-white z-[9999] hidden">
  <div class="flex flex-col items-center space-y-3">
    <div class="w-14 h-14 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></div>
    <p class="text-gray-600 font-medium">Loading...</p>
  </div>
</div>

<div class="min-h-screen flex items-center justify-center px-4">
  <div class="relative w-full max-w-md bg-white rounded-xl p-8 shadow-sm border border-gray-200">
    <div class="flex flex-col items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800">Forgot Password</h2>
      <p class="text-sm text-gray-500 mt-1 text-center">Enter your email to receive reset instructions</p>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="mb-4 px-4 py-3 rounded-lg  capitalize {% if message.tags == 'error' %}bg-red-100 border border-red-300 text-red-800{% elif message.tags == 'success' %}bg-green-100 border border-green-300 text-green-800{% endif %} text-sm" role="alert">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <form method="POST" class="space-y-5">
      {% csrf_token %}
      <div>
        <label for="email" class="text-sm font-medium text-gray-700">Email Address</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-red-500 focus:ring-1 focus:ring-red-500" />
      </div>

      <button type="submit"
        class="w-full py-2 px-4 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition">
        Send Reset Link
      </button>
    </form>

    <p class="text-center text-sm text-gray-600 mt-6">
      Remembered your password? 
      <a href="/login" class="text-red-600 font-semibold hover:underline">Sign in</a>
    </p>
  </div>
  <script>
        document.addEventListener("DOMContentLoaded", function() {
        const loader = document.getElementById("loader");

       function showLoaderAndNavigate(target) {
          loader.classList.remove("hidden");
          loader.style.opacity = "1";

          // Save a flag to detect if we are navigating
          sessionStorage.setItem("navigating", "true");

          setTimeout(() => {
            window.location = target.getAttribute("href");
          }, 1000); // 1 second delay
        }
const internalLinks = document.querySelectorAll(
  'a[href="/forgot_password"], ' +
  'a[href="/login"], ' +
  'a[href="/form"]'
);


      internalLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          showLoaderAndNavigate(this);
        });
      });



      });

      // Hide loader when page loads
      window.addEventListener("load", function() {
        const loader = document.getElementById("loader");

        // Only hide if it exists
        if (loader) {
          loader.style.opacity = "0";
          loader.style.transition = "opacity 0.5s ease";
          setTimeout(() => loader.classList.add("hidden"), 500);
        }

        // Remove the navigation flag
        sessionStorage.removeItem("navigating");
      });

      // Prevent infinite spinner when coming from back button
      window.addEventListener("pageshow", function(event) {
        const loader = document.getElementById("loader");

        // If this is a back/forward navigation, ensure loader is hidden
        if (event.persisted || sessionStorage.getItem("navigating") !== "true") {
          if (loader) loader.classList.add("hidden");
        }
      });
  </script>
</div>
{% endblock %}
